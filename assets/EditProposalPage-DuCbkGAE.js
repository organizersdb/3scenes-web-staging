import{r as s,j as e,S as T,e as $,T as B,A as F,f as q,u as P,a as V,g as C,B as f,M as _,d as D}from"./index-D_Je3U8E.js";import{u as G,a as H,B as g,b as Y}from"./Input-ILcMCOfW.js";import{M as z}from"./index-Bet9U9ah.js";import{T as W}from"./Textarea-QWig5_4q.js";import{S as J}from"./Separator-ByB699LM.js";import{S as K}from"./ScriptHeader-Bqs4MBCG.js";const k=({register:o,fieldName:x,watch:p,placeholder:b})=>{const[l,u]=s.useState(!1),m=p(x)||"";return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-end",children:[e.jsx("button",{className:`${l?"bg-[#e2e3e7]":"bg-[#f0f1f3]"} rounded-t px-2 py-1 text-xs`,type:"button",onClick:()=>u(!0),children:"預覽"}),e.jsx("button",{className:`${l?"bg-[#f0f1f3]":"bg-[#e2e3e7]"} rounded-t px-2 py-1 text-xs`,type:"button",onClick:()=>u(!1),children:"編輯"})]}),l?e.jsx("div",{className:"w-full cursor-not-allowed bg-white p-2 focus:outline-none",children:e.jsx(z,{className:"markdown-preview",children:m})}):e.jsxs("div",{children:[e.jsx("div",{className:"h-8 w-full bg-[#e2e3e7]"}),e.jsx("textarea",{rows:10,className:"w-full border border-[#f0f1f3] bg-white p-2 focus:outline-none",...o(x),value:m,placeholder:b})]})]})},Q=()=>{var S;const{saveScript:o}=s.useContext(T),{createProposal:x}=s.useContext($),{showAlert:p,theme:b}=s.useContext(B),{authUser:l,authSwrFetcher:u}=s.useContext(F),m=q(),[R,h]=s.useState(!1),{jobId:v}=P(),{data:t}=V(v?`/job/view?id=${v}`:null,u),I=s.useCallback(()=>{h(!0)},[]),N=(S=l==null?void 0:l.screenwriter)==null?void 0:S.id,{register:a,control:A,formState:{errors:c},handleSubmit:w,watch:r,trigger:L}=G({mode:"onChange",defaultValues:U}),{fields:d,append:E,remove:M}=H({control:A,name:"script.scenes"}),y=s.useCallback(async()=>{m("/acknowledgement",{state:{initialCountdown:5,heading:"你已成功遞交劇本投稿！",paragraphs:["3scenes.io 將會於 3 個工作天內審閱劇本投稿，成功申請將會刊登於本平台。","如有任何查詢，請聯絡 info@3scenes.io"],countdownText:"頁面將於{countdown}秒後返回尋找編劇頁面",redirectPath:"/opportunities"}})},[m]),O=s.useCallback(async i=>{if(!N||!t)return;const n={...i.script,screenwriterId:N},j=await o(n);j.id?(delete i.script,(await x({...i,jobId:t.id,screenwriterId:N,scriptId:j.id})).id?y():(h(!1),p({severity:"ERROR",content:"抱歉，系統遇到技術問題，請稍後重試。若問題持續，請與我們聯絡。"}))):(h(!1),p({severity:"ERROR",content:"抱歉，系統遇到技術問題，請稍後重試。若問題持續，請與我們聯絡。"}))},[t,o,y,x]);return t?e.jsxs("form",{children:[e.jsxs("section",{className:"font-sans text-xl",children:["應徵活動：",e.jsx("b",{children:t.title})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("section",{id:"scenes",children:[e.jsx(C,{text:"三場劇本"}),e.jsx("div",{className:"flex flex-col gap-y-12",children:d==null?void 0:d.map((i,n)=>e.jsxs("div",{className:"border border-black p-12",children:[e.jsxs("header",{className:"grid lg:grid-cols-[200px_1fr]",children:[e.jsxs("div",{className:"flex",children:[e.jsx(g,{className:"w-[80px]",textAlign:"center",fieldName:`script.scenes[${n}].no`,register:a,watch:r,errors:c,placeholder:"場",maxLength:1}),e.jsx("div",{className:"mx-2 mt-9 h-[3rem] border-r-2 border-black"}),e.jsx(g,{className:"w-[80px]",textAlign:"center",fieldName:`script.scenes[${n}].time`,register:a,watch:r,errors:c,placeholder:"時",maxLength:1})]}),e.jsx(g,{className:"w-auto max-w-[500px] justify-self-end",fieldName:`script.scenes[${n}].location`,register:a,watch:r,errors:c,placeholder:"景",maxLength:10})]}),e.jsxs("div",{className:"pt-16 text-3xl leading-[3rem]",children:[e.jsx(k,{fieldName:`script.scenes[${n}].content`,register:a,watch:r}),n>0&&e.jsx(f,{size:"small",text:"刪除場景",onClick:j=>{j.preventDefault(),M(n)}})]})]},i.no))}),(d==null?void 0:d.length)<3&&e.jsx("div",{className:"flex justify-end",children:e.jsx(f,{icon:e.jsx(X,{}),iconPosition:"left",className:"mt-12",text:"新增場景",onClick:i=>{i.preventDefault(),E({no:"",time:"",location:"",content:""})}})})]}),e.jsxs("section",{id:"outline",children:[e.jsx(C,{text:"劇本資料"}),e.jsxs("div",{className:"notched-corner-top-right border border-black p-10",children:[e.jsxs("header",{children:[e.jsx("div",{className:"flex items-end justify-between",children:e.jsx("h2",{className:"text-5xl font-semibold",children:e.jsx(g,{fieldName:"script.title",register:a,watch:r,errors:c,placeholder:"劇本名稱",maxLength:10,validation:{required:"請輸入劇本名稱"}})})}),e.jsx(J,{className:"my-1"}),e.jsxs("div",{className:"flex justify-between font-sans font-light text-gray-500",children:[e.jsxs("span",{children:["類型：",t.categories.join("、")]}),e.jsx("span",{children:t.collabMode})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(W,{fieldName:"script.logline",register:a,placeholder:"LOGLINE",maxLength:50,errors:c,validation:{required:"請輸入LOGLINE",maxLength:{value:50,message:"最多輸入50字"}},className:"border border-dashed",theme:b})}),e.jsx("div",{className:"mt-12 text-3xl leading-[3rem]",children:e.jsx(k,{fieldName:"script.outline",register:a,watch:r,placeholder:"故事大綱"})})]}),e.jsx("div",{className:"mt-12 flex justify-center",children:e.jsxs("div",{className:"min-w-[450px]",children:[e.jsx("h3",{className:"font-sans font-bold",children:"你的期望薪金？"}),e.jsx("p",{children:`此項目以${t.rate}`}),e.jsx(Y,{className:"mt-7",fieldName:"offer",register:a,watch:r,type:"number",errors:c,label:"填寫你的期望薪金",validation:{required:"請填寫你的期望薪金"}})]})})]}),e.jsx("div",{className:"mt-12 flex justify-center",children:e.jsx(f,{text:"提交",className:"border-indigo bg-indigo text-white",onClick:async()=>{await L()&&w(I)()}})}),e.jsx(_,{isOpen:R,onClose:()=>h(!1),children:e.jsxs("div",{className:"mx-auto flex w-64 flex-col items-center gap-y-2 py-10 text-center",children:[e.jsx("div",{className:"font-serif text-3xl font-bold",children:"你確定要投稿嗎？"}),e.jsx("div",{className:"font-light",children:"徵稿方將會收到投稿資料"}),e.jsxs("div",{className:"flex gap-x-3",children:[e.jsx(f,{text:"返回",type:"button",onClick:()=>h(!1)}),e.jsx(f,{className:"border-indigo bg-indigo text-white",text:"提交",type:"button",onClick:w(O)})]})]})})]})]}):e.jsx(e.Fragment,{})},X=()=>e.jsxs("svg",{width:"13",height:"13",viewBox:"0 0 13 13",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("line",{x1:"6.16992",y1:"2.18557e-08",x2:"6.16992",y2:"13",stroke:"black"}),e.jsx("line",{y1:"6.84778",x2:"13",y2:"6.84778",stroke:"black"})]}),Z={screenwriterId:"",highlight:"",title:"",logline:"",outline:"",category:"",duration:0,progress:"",status:"draft",author:[],scenes:[{no:"",time:"",location:"",content:""}]},U={jobId:"",isShortlisted:!1,isArchived:!1,screenwriterId:"",offer:0,description:"",currency:"",details:"",script:Z},ee=[{anchor:"scenes",text:"三場劇本"},{anchor:"outline",text:"劇本資料"}],oe=()=>{const{id:o}=P();return e.jsxs("div",{className:"mt-24 font-serif",children:[e.jsx(K,{text:o?"編輯劇本":"劇本投稿"}),e.jsxs("div",{className:"grid md:grid-cols-12 md:px-12 md:py-32",children:[e.jsx("aside",{className:"sticky top-12 col-span-3 hidden self-start md:block",children:e.jsx(D,{anchors:ee})}),e.jsx("div",{className:"col-span-9",children:e.jsx(Q,{})})]})]})};export{oe as default};
